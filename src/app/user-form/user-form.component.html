<div class="container mx-auto p-8">
    <h1 class="text-4xl font-extrabold text-gray-900 text-center mb-8">
        {{ isEditing() ? 'Editar Usuario' : 'Agregar Usuario' }}
    </h1>

    <div class="max-w-lg mx-auto">
        <form (ngSubmit)="onSubmit()" class="space-y-6">

            <!-- SecciÃ³n de imagen de perfil -->
            <div class="border rounded-lg p-4 bg-gray-50">
                <label class="block text-sm font-medium text-gray-700 mb-2">Imagen de Perfil</label>
                
                <!-- Preview de imagen -->
                <div class="flex flex-col items-center mb-4">
                    @if (profileImagePreview()) {
                        <img [src]="profileImagePreview()" alt="Vista previa" class="w-32 h-32 rounded-full object-cover border-2 border-gray-300 mb-2">
                        <button type="button" (click)="removeSelectedImage()" class="text-red-600 text-sm hover:text-red-800 mb-2">
                            âœ• Remover imagen seleccionada
                        </button>
                    } @else if (existingImageUrl()) {
                        <img [src]="existingImageUrl()" alt="Imagen actual" class="w-32 h-32 rounded-full object-cover border-2 border-gray-300 mb-2">
                        <p class="text-sm text-gray-600">Imagen actual del usuario</p>
                    } @else {
                        <div class="w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center border-2 border-dashed border-gray-300 mb-2">
                            <span class="text-gray-400 text-4xl">ðŸ‘¤</span>
                        </div>
                        <p class="text-sm text-gray-600">Sin imagen de perfil</p>
                    }
                </div>

                <!-- Input de archivo -->
                <input
                    type="file"
                    id="profileImage"
                    name="profileImage"
                    (change)="onImageSelected($event)"
                    accept="image/jpeg,image/png,image/jpg,image/gif,image/svg+xml"
                    class="hidden"
                >
                
                <label for="profileImage" class="cursor-pointer bg-white border border-gray-300 rounded-md px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 flex items-center justify-center mb-2">
                    ðŸ“· {{ profileImagePreview() || existingImageUrl() ? 'Cambiar imagen' : 'Seleccionar imagen' }}
                </label>
                
                <p class="text-xs text-gray-500 text-center">
                    Formatos: JPEG, PNG, JPG, GIF, SVG â€¢ MÃ¡ximo: 2MB
                </p>

                @if (isUploadingImage()) {
                    <div class="mt-2 text-center">
                        <div class="inline-flex items-center px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-800 mr-2"></div>
                            Subiendo imagen...
                        </div>
                    </div>
                }
            </div>

            <div>
                <label for="nombre" class="block text-sm font-medium text-gray-700 mb-1">Nombre</label>
                <input
                type="text"
                name="nombre"
                [ngModel]="nombre()"
                (ngModelChange)="nombre.set($event)"
                required
                class="mt-1 block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
                placeholder="Nombre"
                autocomplete="nombre"
                >
            </div>
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input
                type="text"
                name="email"
                [ngModel]="email()"
                (ngModelChange)="email.set($event)"
                required
                class="mt-1 block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
                placeholder="Email"
                autocomplete="email"
                >
            </div>
            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">ContraseÃ±a</label>
                <input
                type="password"
                name="password"
                [ngModel]="password()"
                (ngModelChange)="password.set($event)"
                required
                class="mt-1 block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
                placeholder="Password"
                autocomplete="password"
                >
            </div>

            <!-- Nuevo campo de selecciÃ³n de Perfil -->
            <div>
                <label for="profileId" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Permiso</label>
                <select
                name="profileId"
                [ngModel]="profileId()"
                (ngModelChange)="profileId.set($event)"
                required
                class="mt-1 block w-full px-5 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
                >
                <option value="" disabled selected>Selecciona un perfil</option>
                @for (profile of profiles(); track profile._id) {
                    <option 
                        [value]="profile._id" 
                        [selected]="profileId() === profile._id"
                    >
                        {{ profile.name }}
                    </option>
                }
                </select>
            </div>

            <div class="flex justify-end">
                <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full">Guardar</button>
            </div>
        </form>
    </div>
</div>
